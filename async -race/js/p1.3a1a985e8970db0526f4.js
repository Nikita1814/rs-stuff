(()=>{"use strict";var e={855:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(633),i=a(n(109)),o=a(n(322));t.default=class{constructor(){this.garagePage=new r.GaragePage,this.winnersPage=new o.default,this.header=new i.default(this.garagePage,this.winnersPage)}run(){console.log(" "),this.header.render(),this.garagePage.render(),window.location.hash="garage"}}},85:function(e,t){var n=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function s(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.winner=null,this.raceStatus=!1}toggleEngine(e,t){return n(this,void 0,void 0,(function*(){const n=yield fetch(`http://127.0.0.1:3000/engine?id=${e}&status=${t}`,{method:"PATCH"});if(n.ok)return yield n.json()}))}toggleDrive(e,t){return n(this,void 0,void 0,(function*(){t=t;const n=yield fetch(`http://127.0.0.1:3000/engine?id=${e}&status=drive`,{method:"PATCH"});if(500===n.status)throw new Error("500");if(!1===this.raceStatus&&"race"===t)throw new Error("500");if(n.ok)return n}))}animateCar(e,t,n){const a=document.querySelector(".car-track-bottom").offsetWidth/100*76;e.animate([{transform:`translateX(${a}px)`}],{duration:t/n,easing:"ease-in"}).onfinish=()=>{e.style.transform=`translateX(${a}px)`}}beginRace(){var e,t;return n(this,void 0,void 0,(function*(){null===(e=document.querySelector(".header-cover"))||void 0===e||e.classList.remove("hidden"),null===(t=document.querySelector(".reset-btn"))||void 0===t||t.classList.add("inactive"),window.setTimeout((()=>{var e,t;null!==this.winner&&this.showAnnouncement(this.winner),null===(e=document.querySelector(".reset-btn"))||void 0===e||e.classList.remove("inactive"),null===(t=document.querySelector(".header-cover"))||void 0===t||t.classList.add("hidden")}),13e3),this.timer(),this.raceStatus=!0;const n=[...document.querySelectorAll(".car-track")].map((e=>{var t,n;null===(t=e.querySelector(".start-btn"))||void 0===t||t.classList.add("car-control-active"),null===(n=e.querySelector(".stop-btn"))||void 0===n||n.classList.remove("car-control-active");const a=Number(e.dataset.trackId),r=e.querySelector(".race-car");return this.startCarRace(a,r)}));yield Promise.allSettled(n)}))}resetRace(){this.winner=null,this.raceStatus=!1,document.querySelectorAll(".car-track").forEach((e=>{var t,n;null===(t=e.querySelector(".start-btn"))||void 0===t||t.classList.remove("car-control-active"),null===(n=e.querySelector(".stop-btn"))||void 0===n||n.classList.add("car-control-active");const a=e.querySelector(".race-car");a.getAnimations().forEach((e=>e.cancel())),this.toggleEngine(Number(e.dataset.trackId),"stopped"),a.style.transform="translateX(0px)"}))}addWinner(e,t){null===this.winner&&(this.winner={id:e,wins:1,time:t},this.handleWinner(this.winner))}handleWinner(e){return n(this,void 0,void 0,(function*(){e=e;const t=yield fetch(`http://127.0.0.1:3000/winners/${e.id}`,{method:"GET"});if(t.ok){const n=yield t.json();yield fetch(`http://127.0.0.1:3000/winners/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({wins:n.wins+1,time:Math.min(n.time,e.time)})})}else yield fetch("http://127.0.0.1:3000/winners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}))}startCarRace(e,t){return n(this,void 0,void 0,(function*(){yield this.toggleEngine(e,"started").then((n=>{this.animateCar(t,n.distance,n.velocity),this.toggleDrive(e,"race").then((()=>{this.toggleEngine(e,"stopped"),null===this.winner&&"#garage"===window.location.hash&&!0===this.raceStatus&&(this.addWinner(e,Math.round(n.distance/n.velocity/1e3)),this.raceStatus=!1)})).catch((n=>{if(n){const n=t.getAnimations()[0];n&&n.pause(),this.toggleEngine(e,"stopped")}}))}))}))}startCarManual(e,t){const n=e,a=document.querySelector(`[data-track-id="${e}"]`).querySelector(".race-car");this.toggleEngine(n,t).then((r=>{"started"===t?(this.animateCar(a,r.distance,r.velocity),this.toggleDrive(n,"manual").then((()=>{this.toggleEngine(n,"stopped")})).catch((t=>{t&&(a.getAnimations()[0].pause(),this.toggleEngine(e,"stopped"))}))):(a.getAnimations().forEach((e=>e.cancel())),a.style.transform="translateX(0px)")}))}timer(){let e=12;const t=setInterval((()=>{document.querySelector(".race-timer").innerHTML=`Race Timer:${e}`,e--,-1===e&&clearInterval(t)}),1e3)}showAnnouncement(e){var t,n;const a=null===(t=document.querySelector(`[data-car-id="${e.id}"]`))||void 0===t?void 0:t.dataset.trackName;null===(n=document.querySelector(".announcement-overlay"))||void 0===n||n.classList.remove("hidden"),document.querySelector(".announcement-name").innerHTML=`${a} Won!`,document.querySelector(".announcement-seconds").innerHTML=`${this.winner.time} s`}}},287:function(e,t){var n=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function s(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageGrid=void 0,t.GarageGrid=class{constructor(e){this.controller=e,this.currentPage=1,this.pageTotal=7}render(){return n(this,void 0,void 0,(function*(){yield this.getTotal(),yield this.getCars()}))}addListeners(){var e;null===(e=document.querySelector(".garage-page-controls"))||void 0===e||e.addEventListener("click",(e=>{const t=e.target;t.dataset.direction&&this.switchPage(t.dataset.direction)}))}getTotal(){var e;return n(this,void 0,void 0,(function*(){const t=yield fetch("http://127.0.0.1:3000/garage?_limit=7");this.pageTotal=Math.ceil(Number(null===(e=[...t.headers.entries()].find((e=>"x-total-count"===e[0])))||void 0===e?void 0:e[1])/7)}))}getCars(){var e;return n(this,void 0,void 0,(function*(){const t=yield fetch(`http://127.0.0.1:3000/garage?_page=${this.currentPage}&_limit=7`);if(t.ok){document.querySelector(".car-count").innerHTML=`Garage(${null===(e=[...t.headers.entries()].find((e=>"x-total-count"===e[0])))||void 0===e?void 0:e[1]})`;const n=yield t.json();this.showCars(n)}}))}showCars(e){const t=document.querySelector(".garage-grid-page");t.dataset.pageNum=`${this.currentPage}`,t.innerHTML=`<h2>Page #${this.currentPage}</h2>`,e.forEach((e=>{t.innerHTML+=`\n        <div data-track-name=${e.name} data-track-id=${e.id} class="car-track">\n        <div class="car-track-top">\n            <button data-select=${e.id} class="garage-button car-select button-white">Select</button>\n            <button data-delete=${e.id} class="garage-button car-remove button-white">Remove</button>\n            <h3 class="car-title">${e.name}</h3>\n        </div>\n        <div class="car-track-bottom">\n            <div data-track-name=${e.name} data-car-id=${e.id} class="activation-btns">\n                <button data-status="started" class="activation-btn start-btn">A</button>\n                <button data-status="stopped" class="activation-btn stop-btn car-control-active">B</button>\n                </div>\n                <div class="race-car" style="background-color:${e.color};"></div>\n        </div>\n    </div>\n        `}))}switchPage(e){"next"===e?(this.getTotal(),this.currentPage<this.pageTotal?(this.currentPage+=1,this.getCars()):(this.currentPage=1,this.getCars())):(this.getTotal(),this.currentPage>1?(this.currentPage-=1,this.getCars()):(this.currentPage=this.pageTotal,this.getCars()))}}},515:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function s(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(633);t.default=class{constructor(e,t){this.grid=e,this.controller=t,this.carBrands=["Toyota","BMW","Mercedes","Audi","Kia","Hyundai","Tesla","Renaul","Ford","Honda"],this.carModels=["Rio","Focus","Kalina","Vesta","Spark","Lacetti","Nexia","Matiz","Cobalt","Captiva"],this.selectedCar=null}addListeners(){var e,t;null===(e=document.querySelector(".race-btn"))||void 0===e||e.addEventListener("click",(()=>{var e,t,n;(null===(e=document.querySelector(".race-btn"))||void 0===e?void 0:e.classList.contains("inactive"))||(null===(t=document.querySelector(".race-btn"))||void 0===t||t.classList.add("inactive"),null===(n=document.querySelector(".reset-btn"))||void 0===n||n.classList.remove("inactive"),this.controller.beginRace())})),null===(t=document.querySelector(".reset-btn"))||void 0===t||t.addEventListener("click",(()=>{var e,t,n;(null===(e=document.querySelector(".reset-btn"))||void 0===e?void 0:e.classList.contains("inactive"))||(this.controller.resetRace(),null===(t=document.querySelector(".race-btn"))||void 0===t||t.classList.remove("inactive"),null===(n=document.querySelector(".reset-btn"))||void 0===n||n.classList.add("inactive"))}))}generateCars(e,t){for(let n=1;n<100;n++){const n=new r.Car(`${e[Math.floor(9*Math.random())]} ${t[Math.floor(9*Math.random())]}`,`#${Math.floor(16777215*Math.random()).toString(16)}`);this.createCar(n)}this.grid.render()}createCar(e){return a(this,void 0,void 0,(function*(){yield fetch("http://127.0.0.1:3000/garage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}))}deleteCar(e){return a(this,void 0,void 0,(function*(){yield fetch(`http://127.0.0.1:3000/garage/${e}`,{method:"DELETE"}),yield fetch(`http://127.0.0.1:3000/winners/${e}`,{method:"DELETE"})}))}selectCar(e){var t,n,r,i;return a(this,void 0,void 0,(function*(){const a=yield fetch(`http://127.0.0.1:3000/garage/${e}`,{method:"GET"});a.ok&&(this.selectedCar=yield a.json(),null===(t=document.querySelector(".update-name"))||void 0===t||t.removeAttribute("disabled"),null===(n=document.querySelector(".update-btn"))||void 0===n||n.removeAttribute("disabled"),document.querySelector(".update-name").value=null===(r=this.selectedCar)||void 0===r?void 0:r.name,document.querySelector(".update-color").value=null===(i=this.selectedCar)||void 0===i?void 0:i.color)}))}updateCar(e,t){var n,r;return a(this,void 0,void 0,(function*(){(yield fetch(`http://127.0.0.1:3000/garage/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok&&(this.selectedCar=null,null===(n=document.querySelector(".update-name"))||void 0===n||n.setAttribute("disabled","dsiabled"),null===(r=document.querySelector(".update-btn"))||void 0===r||r.setAttribute("disabled","disabled"),document.querySelector(".update-name").value="",document.querySelector(".update-color").value="#000000")}))}}},633:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function s(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Car=t.GaragePage=void 0;const i=r(n(85)),o=n(287),s=r(n(515));class c{constructor(e,t){this.name=e,this.color=t}}t.Car=c,t.GaragePage=class{constructor(){this.controller=new i.default,this.garageGrid=new o.GarageGrid(this.controller),this.garageMenu=new s.default(this.garageGrid,this.controller)}render(){return a(this,void 0,void 0,(function*(){document.querySelector(".main").innerHTML='\n        <div class="announcement-overlay hidden">\n        <div class="announcement">\n        <div class = "announcement-flag"></div>\n         <h1 class="announcement-name">Car Won!</h1>\n         <h2 class="announcement-seconds">(s)</h2>\n         <button class="garage-button button-green close-announcement">Close</button>\n        </div>\n        </div>\n      <div class="garage-page" >\n        <div class="garage-menu">\n            <div>\n                <input type="text" class="create-name"> <input type="color" class="create-color"> <button class="garage-button button-white create-btn">Create</button>\n            </div>\n            <div>\n                <input type="text" class="update-name" disabled> <input type="color" class="update-color"> <button class="garage-button button-white update-btn disabled">Update</button>\n            </div>\n            <div>\n                <button class="garage-button race-btn button-green">Race</button> \n                <button class="garage-button reset-btn button-green inactive">Reset</button> \n                <button class="garage-button generate-btn">Generate Cars</button>\n            </div>\n        </div>\n       <div class="race-timer">Race Timer:12</div>\n        <h1 class="car-count">Garage(7)</h1>\n        <div class="garage-grid">\n        <div data-page-num="1" class="garage-grid-page">\n            <h2>Page #1</h2>\n            <div data-track-name="Tesla" data-track-id=""class="car-track">\n                <div class="car-track-top">\n                    <button class="garage-button car-select button-white">Select</button>\n                    <button class="garage-button car-remove button-white">Remove</button>\n                    <h3 class="car-title">Tesla</h3>\n                </div>\n                <div class="car-track-bottom">\n                    <div class="activation-btns">\n                        <button class="activation-btn start-btn">A</button>\n                        <button class="activation-btn stop-btn">B</button>\n                        </div>\n                        <div class="race-car"></div>\n                </div>\n            </div>\n        </div>\n        </div>\n        <div class="garage-page-controls">\n        <button data-direction="prev" class ="garage-button button-green">Previous</button>\n        <button data-direction="next" class ="garage-button button-green">Next</button>\n        </div>\n    </div>\n      ',yield this.garageGrid.render().then((e=>{this.addControls()})),this.addListeners()}))}addListeners(){var e,t,n,r;this.garageGrid.addListeners(),this.garageMenu.addListeners(),null===(e=document.querySelector(".close-announcement"))||void 0===e||e.addEventListener("click",(()=>{var e;null===(e=document.querySelector(".announcement-overlay"))||void 0===e||e.classList.add("hidden")})),null===(t=document.querySelector(".create-btn"))||void 0===t||t.addEventListener("click",(()=>{this.garageMenu.createCar(new c(document.querySelector(".create-name").value,document.querySelector(".create-color").value)).then((()=>a(this,void 0,void 0,(function*(){yield this.garageGrid.render(),this.addControls()}))))})),null===(n=document.querySelector(".update-btn"))||void 0===n||n.addEventListener("click",(()=>{this.garageMenu.updateCar(new c(document.querySelector(".update-name").value,document.querySelector(".update-color").value),this.garageMenu.selectedCar.id).then((()=>a(this,void 0,void 0,(function*(){yield this.garageGrid.render(),this.addControls()}))))})),null===(r=document.querySelector(".generate-btn"))||void 0===r||r.addEventListener("click",(()=>{this.garageMenu.generateCars(this.garageMenu.carBrands,this.garageMenu.carModels)}))}addControls(){document.querySelectorAll(".car-select").forEach((e=>{e.addEventListener("click",(e=>{this.garageMenu.selectCar(Number(e.target.dataset.select))}))})),document.querySelectorAll(".car-remove").forEach((e=>{e.addEventListener("click",(e=>{this.garageMenu.deleteCar(Number(e.target.dataset.delete)).then((()=>a(this,void 0,void 0,(function*(){yield this.garageGrid.render(),this.addControls()}))))}))})),document.querySelectorAll(".activation-btns").forEach((e=>{e.addEventListener("click",(t=>{const n=t.target;n.classList.contains("activation-btn")&&!n.classList.contains("car-control-active")&&(e.querySelectorAll(".activation-btn").forEach((e=>{e.classList.toggle("car-control-active")})),this.controller.startCarManual(Number(e.dataset.carId),n.dataset.status))}))}))}switchPage(e){"next"===e&&this.garageGrid.currentPage}}},109:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.garage=e,this.winners=t,this.activePage=this.garage}render(){const e=document.createElement("header");e.innerHTML='\n        <div class="header-cover hidden"></div>\n    <nav class="page-navigation">\n        <a href="#garage" class="page-link button-green active-link">To Garage</a>\n        <a href="#winners" class="page-link button-green "> To Winners</a>\n    </nav>\n    ';const t=document.createElement("main");t.classList.add("main"),document.querySelector(".body").append(e),document.querySelector(".body").append(t),this.addListeners()}addListeners(){window.addEventListener("hashchange",(e=>{this.garage.garageGrid.controller.winner=null,this.activePage===this.garage&&this.garage.garageGrid.controller.resetRace(),this.switchPage(e)}))}switchPage(e){var t,n;switch(null===(t=document.querySelectorAll(".page-link"))||void 0===t||t.forEach((e=>{e.classList.remove("active-link")})),null===(n=document.querySelector(`[href='#${e.newURL.split("#")[1]}']`))||void 0===n||n.classList.toggle("active-link"),e.newURL.split("#")[1]){case"garage":this.garage.render();break;case"winners":this.winners.render()}}}},322:function(e,t){var n=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function s(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.currentPage=1,this.pageTotal=1,this.sort="id",this.order="DESC"}render(){document.querySelector(".main").innerHTML=`\n      <div class="winners-page"">\n            <h1 class ="winner-count">Winners()!</h1>\n            <div class="winners-table">\n                <div class="winners-table-top winners-table-row">\n                    <p data-sort="id" data-order="DESC" active-sort>Number</p>\n                    <p>Car</p>\n                    <p>Name</p>\n                    <p data-sort="wins" data-order="DESC">Wins</p>\n                    <p data-sort="time" data-order="DESC">Time (seconds)</p>\n                </div>\n                <div class="table-page" data-page-num=${this.currentPage}>\n                </div>\n                <div class="winners-table-row">\n                    <button class="garage-button winner-change button-green" data-direction="previous">Prev</button>\n                    <h2 class="winner-page-header">Page #${this.currentPage}</h2>\n                    <button class="garage-button winner-change button-green" data-direction="next">Next</button>\n                </div>\n            </div>\n        </div>\n      `,this.getWinners(),this.addListneners()}getWinners(){var e;return n(this,void 0,void 0,(function*(){const t=yield fetch(`http://127.0.0.1:3000/winners?_page=${this.currentPage}&_sort=${this.sort}&_order=${this.order}_limit=10`);if(t.ok){const n=null===(e=[...t.headers.entries()].find((e=>"x-total-count"===e[0])))||void 0===e?void 0:e[1];document.querySelector(".winner-count").innerHTML=`Winners(${n})`,this.pageTotal=Math.ceil(Number(n)/10);const a=yield t.json();this.showWinners(a)}else console.log("an error occured")}))}getTotal(){var e;return n(this,void 0,void 0,(function*(){const t=yield fetch("http://127.0.0.1:3000/winners?_limit=10");this.pageTotal=Math.ceil(Number(null===(e=[...t.headers.entries()].find((e=>"x-total-count"===e[0])))||void 0===e?void 0:e[1])/10)}))}showWinners(e){return n(this,void 0,void 0,(function*(){const t=document.querySelector(".table-page");t.innerHTML="",t.dataset.pageNum=`${this.currentPage}`;for(const n of e)yield this.drawWinner(n.id,n,t)}))}drawWinner(e,t,a){return n(this,void 0,void 0,(function*(){const n=yield fetch(`http://127.0.0.1:3000/garage/${e}`,{method:"GET"});if(n.ok){const e=yield n.json();a.innerHTML+=` \n            <div data-car-id="${e.id}" class="winners-table-winner winners-table-row">\n            <p>${e.id}</p>\n            <div class="car winner-car"style="background-color:${e.color}"></div>\n            <p>${e.name}</p>\n            <p>${t.wins}</p>\n            <p>${t.time} s</p>\n        </div>\n            `}}))}addListneners(){var e,t;null===(e=document.querySelectorAll("[data-sort]"))||void 0===e||e.forEach((e=>{e.addEventListener("click",(e=>{var t;null===(t=document.querySelectorAll("[data-sort]"))||void 0===t||t.forEach((e=>{e.classList.remove("active-sort")}));const n=e.target;n.classList.add("active-sort"),this.sort=n.dataset.sort,this.order=n.dataset.order,n.dataset.order="DESC"===n.dataset.order?"ASC":"DESC",this.getWinners()}))})),null===(t=document.querySelectorAll(".winner-change"))||void 0===t||t.forEach((e=>{e.addEventListener("click",(e=>{var t;this.switchPage(`${null===(t=e.target)||void 0===t?void 0:t.dataset.direction}`)}))}))}switchPage(e){"next"===e?(this.getTotal(),this.currentPage<this.pageTotal?(this.currentPage+=1,this.getWinners()):(this.currentPage=1,this.getWinners())):(this.getTotal(),this.currentPage>1?(this.currentPage-=1,this.getWinners()):(this.currentPage=this.pageTotal,this.getWinners())),document.querySelector(".winner-page-header").innerHTML=`\n        Page #${this.currentPage}\n        `}}},323:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(855));console.log('Cамооценка \n\n180+/190\n \nне выполнил пункт сохранения стейта страниц в локал сторадж\n\nдоп ф-нал: добавил таймер (сообщение с результатом гонки появляется после него), баллы на ваше усмотрение\n\n\n\nBasic structure - 15\n\n"Garage" view - 50\n\nCar animation - 50\n\nRace animation - 30\n\n"Winners" view - 35\n'),(new r.default).run()}},t={};!function n(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}(323)})();